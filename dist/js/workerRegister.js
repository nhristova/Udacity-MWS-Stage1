import{toasty}from'./toasty.js';export function WorkerRegister(){window.onoffline=()=>toasty.showMessage('No internet connection \uD83D\uDC94, loading from cache.',toasty.type.error),window.ononline=()=>toasty.showMessage('Internet is back! \u2764',toasty.type.success),this.registerServiceWorker()}WorkerRegister.prototype.registerServiceWorker=function(){if(navigator.serviceWorker&&window.SyncManager){const a=this;navigator.serviceWorker.register('/sw.js').then(function(c){return toasty.showMessage('SW registered',toasty.type.success),navigator.serviceWorker.controller?c.waiting?(console.log('SW waiting'),void a.updateReady(c.waiting)):c.installing?(console.log('SW installing'),void a.trackInstalling(c.installing)):void(c.onupdatefound=()=>{c.installing&&(console.log('Caught a SW installing!'),a.trackInstalling(c.installing)),c.waiting&&(console.log('Caught a SW waiting'),a.updateReady(c.waiting))}):void console.log('Latest version')}).catch(c=>console.log('Error registering serviceWorker',c)),navigator.serviceWorker.ready.then(c=>{return window.addEventListener('online',()=>{c.sync.register('sync-reviews-on-online').catch(d=>console.log('Controller failed to register sync-reviews-on-online, error: ',d))}),c.sync.register('sync-reviews-on-reload').catch(d=>console.log('Controller failed to register sync-reviews-on-reload, error: ',d))});let b;navigator.serviceWorker.addEventListener('controllerchange',()=>{b||(window.location.reload(),b=!0)})}},WorkerRegister.prototype.trackInstalling=function(a){const b=this;console.log('Track installing'),a.addEventListener('statechange',function(){console.log('State change: ',a.state),'installed'==a.state&&b.updateReady(a)})},WorkerRegister.prototype.updateReady=function(a){toasty.showMessage('New SW version ready,  update?<br /><button type="button" class="btn btn-primary" data-action="update" id="okBtn">Yes</button> <button type="button" class="btn btn-primary" data-action="noupdate" id="noBtn">No</button>',toasty.type.info,{onclick:function(d){const e=d.target.getAttribute('data-action');'update'===e&&a.postMessage({action:'skipWaiting'}),d.target.closest('.toast').remove()}})};
