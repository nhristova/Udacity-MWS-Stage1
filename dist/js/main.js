import{WorkerRegister}from'./workerRegister.js';import{shared}from'./shared.js';let restaurants,neighborhoods,cuisines,map,markers=[];document.addEventListener('DOMContentLoaded',()=>{fetchNeighborhoods(),fetchCuisines(),updateRestaurants(),GoogleMapsLoader.KEY='AIzaSyD7KC8kdJmtPQc1QOG9QFJP-I9Nd-i5eC0',GoogleMapsLoader.LIBRARIES=['places'],GoogleMapsLoader.load(initMap)}),window.onload=()=>{addMarkersToMap(),shared.initStarFav(document.getElementById('restaurants-list')),new WorkerRegister};const fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');b.addEventListener('change',updateRestaurants),a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');b.addEventListener('change',updateRestaurants),a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f,(g,h)=>{g?console.log(g):(resetRestaurants(h),fillRestaurantsHTML())})},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.restaurants=a,markers&&(markers.forEach(c=>c.setMap(null)),markers=[])},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(c=>{b.append(createRestaurantHTML(c))})},createRestaurantHTML=a=>{const b=document.createElement('li'),c=DBHelper.imageUrlForRestaurant(a),d=document.createElement('span');d.id='star-fav-'+a.id,d.classList.add('star','star-fav'),d.setAttribute('role','checkbox'),d.setAttribute('title','Mark restaurant as favourite'),d.setAttribute('tabindex',0),d.innerHTML='\u2605';const e=a.is_favorite;e&&(d.setAttribute('checked',e),d.classList.add('star-checked')),b.append(d);const f=document.createElement('img');f.className='restaurant-img',f.alt=a.description,f.src=c,f.srcset=`${c.replace('.jpg','_small.jpg')} 400w, ${c} 800w`,f.sizes='(min-width: 480px) 40vw, (min-width: 721px) 29vw, (min-width: 1000px) 22vw',b.append(f);const g=document.createElement('h2');g.innerHTML=a.name,b.append(g);const h=document.createElement('p');h.classList.add('neighborhood'),h.innerHTML=a.neighborhood,b.append(h);const i=document.createElement('p');i.innerHTML=a.address,b.append(i);const j=document.createElement('a');return j.innerHTML='View Details',j.href=DBHelper.urlForRestaurant(a),j.classList.add('btn','btn-warning'),j.setAttribute('aria-label','. Details for restaurant: '+a.name),b.append(j),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',()=>{window.location.href=c.url}),markers.push(c)})};
